DEBUG:<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Pulse Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg:#0a0a0a;
  --card:rgba(20,20,20,.85);
  --accent:#d4af37;
  --danger:#e74c3c;
  --success:#2ecc71;
  --text:#f0f0f0;
}

* { box-sizing:border-box; font-family:Segoe UI, sans-serif; }

body {
  margin:0;
  background:linear-gradient(135deg,#0a0a0a,#151515);
  color:var(--text);
}

header {
  padding:20px 30px;
  border-bottom:1px solid rgba(212,175,55,.2);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

h1 { color:var(--accent); margin:0; }

.tabs {
  display:flex;
  gap:15px;
  padding:20px 30px;
}

.tab {
  padding:10px 20px;
  border-radius:20px;
  cursor:pointer;
  background:rgba(212,175,55,.1);
  border:1px solid rgba(212,175,55,.3);
}

.tab.active {
  background:var(--accent);
  color:#111;
}

.container { padding:0 30px 40px; }

.card {
  background:var(--card);
  border-radius:16px;
  padding:20px;
  margin-bottom:20px;
  border:1px solid rgba(255,255,255,.08);
  backdrop-filter:blur(10px);
}

.hidden { display:none; }

table {
  width:100%;
  border-collapse:collapse;
}

th,td {
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,.1);
  text-align:left;
}

button {
  padding:8px 14px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  font-weight:600;
}

.btn-danger { background:var(--danger); color:#fff; }
.btn-success { background:var(--success); color:#111; }
.btn-accent { background:var(--accent); color:#111; }

.status {
  font-size:13px;
  opacity:.8;
}
.online { color:var(--success); }
.offline { color:#777; }
.call { color:var(--accent); }
.pause { color:#f39c12; }
</style>
</head>

<body>

<header>
  <h1>üëë Pulse Admin</h1>
  <div id="role-info"></div>
</header>

<div class="tabs">
  <div class="tab active" data-tab="operators">–û–ø–µ—Ä–∞—Ç–æ—Ä—ã</div>
  <div class="tab hidden" data-tab="users" id="users-tab">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
</div>

<div class="container">

  <!-- –û–ü–ï–†–ê–¢–û–†–´ -->
  <div id="operators" class="card">
    <h2>üü¢ –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –æ–Ω–ª–∞–π–Ω</h2>
    <table>
      <thead>
        <tr>
          <th>–ò–º—è</th>
          <th>–°—Ç–∞—Ç—É—Å</th>
          <th>–ö–∞–Ω–∞–ª</th>
        </tr>
      </thead>
      <tbody id="operators-list"></tbody>
    </table>
  </div>

  <!-- –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò -->
  <div id="users" class="card hidden">
    <h2>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
    <!-- –°–û–ó–î–ê–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø -->
<div style="margin:15px 0; display:flex; gap:10px; flex-wrap:wrap;">
  <input id="new-login" placeholder="–õ–æ–≥–∏–Ω">
  <input id="new-password" placeholder="–ü–∞—Ä–æ–ª—å">
  <select id="new-role">
    <option value="operator">operator</option>
    <option value="supervisor">supervisor</option>
    <option value="admin">admin</option>
  </select>
  <button id="create-user-btn" class="btn-accent">
    –°–æ–∑–¥–∞—Ç—å
  </button>
</div>

    <div style="margin-bottom:20px; display:flex; gap:10px; flex-wrap:wrap;">
  <input id="new-login" placeholder="–õ–æ–≥–∏–Ω">
  <input id="new-password" placeholder="–ü–∞—Ä–æ–ª—å">
  <select id="new-role">
    <option value="operator">operator</option>
    <option value="supervisor">supervisor</option>
    <option value="admin">admin</option>
  </select>
  <button class="btn-accent" id="create-user-btn">–°–æ–∑–¥–∞—Ç—å</button>
</div>
    <table>
      <thead>
        <tr>
          <th>–õ–æ–≥–∏–Ω</th>
          <th>–†–æ–ª—å</th>
          <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
      </thead>
      <tbody id="users-list"></tbody>
    </table>
  </div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, get, onValue, update, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyARCnSBWkN_2xUFKGlmDBTWV_OIf1-P3pY",
  authDomain: "pulse-ae670.firebaseapp.com",
  databaseURL: "https://pulse-ae670-default-rtdb.firebaseio.com",
  projectId: "pulse-ae670",
  storageBucket: "pulse-ae670.firebasestorage.app",
  messagingSenderId: "353326683454",
  appId: "1:353326683454:web:34ed86590e53cf60a2c86f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const login = localStorage.getItem("pulse_admin_login");
if (!login) location.href = "index.html";

const roleInfo = document.getElementById("role-info");
const usersTab = document.getElementById("users-tab");

const userSnap = await get(ref(db,"users/"+login));
const me = userSnap.val();

roleInfo.textContent = "–†–æ–ª—å: " + me.role;

  
// üî• –ñ–Å–°–¢–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê
if (me && me.role && me.role.trim() === "admin") {
  usersTab.classList.remove("hidden");
} else {
  console.warn("–ù–µ admin, —Ä–æ–ª—å:", me?.role);
}

// TABS
document.querySelectorAll(".tab").forEach(tab=>{
  tab.onclick=()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.querySelectorAll(".card").forEach(c=>c.classList.add("hidden"));
    tab.classList.add("active");
    document.getElementById(tab.dataset.tab).classList.remove("hidden");
  }
});

// OPERATORS
onValue(ref(db,"operators"), snap=>{
  const list=document.getElementById("operators-list");
  list.innerHTML="";
  snap.forEach(c=>{
    const o=c.val();
    let cls="offline";
    if(o.status==="active")cls="online";
    if(o.status==="call")cls="call";
    if(o.status==="pause")cls="pause";
    list.innerHTML+=`
      <tr>
        <td>${c.key}</td>
        <td class="status ${cls}">${o.status||"offline"}</td>
        <td>${o.channel||"-"}</td>
      </tr>`;
  });
});

// USERS (admin only)
if(me.role==="admin"){
onValue(ref(db,"users"), snap=>{
  const list=document.getElementById("users-list");
  list.innerHTML="";
  snap.forEach(c=>{
    const u=c.val();
    list.innerHTML+=`
      <tr>
        <td>${c.key}</td>
        <td>${u.role}</td>
        <td>
          <button class="btn-danger" onclick="deleteUser('${c.key}')">–£–¥–∞–ª–∏—Ç—å</button>
        </td>
      </tr>`;
  });
});
}

window.deleteUser=async(login)=>{
  if(!confirm("–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "+login+"?"))return;
  await remove(ref(db,"users/"+login));
};
</script>
<script type="module">
  window.deleteUser = async (login) => {
    if (!confirm("–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è " + login + "?")) return;
    await remove(ref(db, "users/" + login));
  };

  <!-- –í–û–¢ –°–Æ–î–ê -->
  const createBtn = document.getElementById("create-user-btn");

  if (createBtn) {
    createBtn.onclick = async () => {
      const login = document.getElementById("new-login").value.trim().toLowerCase();
      const password = document.getElementById("new-password").value.trim();
      const role = document.getElementById("new-role").value;

      if (!login || !password) {
        alert("–ó–∞–ø–æ–ª–Ω–∏ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å");
        return;
      }

      await update(ref(db, "users/" + login), {
        login,
        password,
        role
      });

      document.getElementById("new-login").value = "";
      document.getElementById("new-password").value = "";

      alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω");
    };
  }
</script>


</body>
</html>
