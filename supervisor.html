<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Supervisor Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<div id="code-lock">
  <h2>๐ ะะฒะตะดะธัะต ะบะพะด ะดะพัััะฟะฐ</h2>
  <input type="password" id="admin-code" placeholder="ะะพะด">
  <button id="check-code">ะะพะนัะธ</button>
  <div id="code-error" style="color:red"></div>
</div>

<div id="admin-panel" style="display:none;">
  <h1>๐ ะะฐะฝะตะปั ะฐะดะผะธะฝะธัััะฐัะพัะฐ</h1>
  <div id="shifts"></div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getDatabase, ref, get, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  // ๐ ะฟัะพะฒะตัะบะฐ ะปะพะณะธะฝะฐ
  const login = localStorage.getItem("pulse_admin_login");
  if (!login) location.href = "index.html";

  // ๐ฅ Firebase
  const app = initializeApp({
    apiKey: "AIzaSyARCnSBWkN_2xUFKGlmDBTWV_OIf1-P3pY",
    authDomain: "pulse-ae670.firebaseapp.com",
    databaseURL: "https://pulse-ae670-default-rtdb.firebaseio.com",
    projectId: "pulse-ae670"
  });
  const db = getDatabase(app);

  // ๐ ะฟัะพะฒะตัะบะฐ ะบะพะดะฐ
  document.getElementById("check-code").onclick = async () => {
    const inputCode = document.getElementById("admin-code").value;

    const snap = await get(ref(db, `users/${login}/accessCode`));
    const realCode = snap.val();

    if (String(inputCode) === String(realCode)) {
      document.getElementById("code-lock").style.display = "none";
      document.getElementById("admin-panel").style.display = "block";
    } else {
      document.getElementById("code-error").textContent = "โ ะะตะฒะตัะฝัะน ะบะพะด";
    }
  };

  // ๐ ัะปััะฐะตะผ ัะผะตะฝั
  onValue(ref(db, "shifts"), snap => {
    const shifts = snap.val() || {};
    document.getElementById("shifts").innerHTML =
      Object.values(shifts).map(s =>
        `<div>${s.operator} โ ${s.calls || 0} ๐</div>`
      ).join("");
  });
</script>

</body>
</html>
