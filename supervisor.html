<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Supervisor / Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      background:#0f1115;
      color:#fff;
      font-family:Arial,sans-serif;
      padding:20px;
    }
    h1,h2,h3 { margin-bottom:10px; }
    input,select,button {
      padding:8px;
      margin:5px 0;
      border-radius:6px;
      border:none;
      background:#1c1f26;
      color:#fff;
    }
    button { cursor:pointer; }
    .box {
      background:#1c1f26;
      padding:15px;
      border-radius:10px;
      margin-bottom:20px;
    }
    .ok { color:#2ecc71; }
    .err { color:#e74c3c; }
  </style>
</head>

<body>

<h1>üëë –ê–¥–º–∏–Ω / –°—É–ø–µ—Ä–≤–∞–π–∑–µ—Ä –ø–∞–Ω–µ–ª—å</h1>
<h2>‚ûï –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>

<input id="new-login" placeholder="–õ–æ–≥–∏–Ω">
<input id="new-password" placeholder="–ü–∞—Ä–æ–ª—å">

<select id="new-role">
  <option value="operator">–û–ø–µ—Ä–∞—Ç–æ—Ä</option>
  <option value="supervisor">–°—É–ø–µ—Ä–≤–∞–π–∑–µ—Ä</option>
  <option value="admin">–ê–¥–º–∏–Ω</option>
</select>

<button id="create-user-btn">–°–æ–∑–¥–∞—Ç—å</button>
<div id="create-user-status"></div>

  
<div id="access-box" class="box">
  <h2>üîê –ö–æ–¥ –¥–æ—Å—Ç—É–ø–∞</h2>
  <input id="admin-code" type="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥">
  <button id="check-code">–í–æ–π—Ç–∏</button>
  <div id="access-status"></div>
</div>

<div id="admin-panel" class="box" style="display:none;">
  <h2>‚ûï –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>

  <input id="new-login" placeholder="–õ–æ–≥–∏–Ω">
  <input id="new-password" placeholder="–ü–∞—Ä–æ–ª—å">

  <select id="new-role">
    <option value="operator">–û–ø–µ—Ä–∞—Ç–æ—Ä</option>
    <option value="supervisor">–°—É–ø–µ—Ä–≤–∞–π–∑–µ—Ä</option>
    <option value="admin">–ê–¥–º–∏–Ω</option>
  </select>

  <button id="create-user-btn">–°–æ–∑–¥–∞—Ç—å</button>
  <div id="create-user-status"></div>
</div>

<!-- FIREBASE -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyARCnSBWkN_2xUFKGlmDBTWV_OIf1-P3pY",
    authDomain: "pulse-ae670.firebaseapp.com",
    databaseURL: "https://pulse-ae670-default-rtdb.firebaseio.com",
    projectId: "pulse-ae670",
    storageBucket: "pulse-ae670.firebasestorage.app",
    messagingSenderId: "353326683454",
    appId: "1:353326683454:web:34ed86590e53cf60a2c86f"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const login = localStorage.getItem("pulse_admin_login");
  if (!login) location.href = "index.html";

  // üîê –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
  document.getElementById("check-code").onclick = async () => {
    const input = document.getElementById("admin-code").value;
    const status = document.getElementById("access-status");

    const snap = await get(ref(db, "users/" + login + "/accessCode"));
    const real = snap.val();

    if (String(input) === String(real)) {
      document.getElementById("access-box").style.display = "none";
      document.getElementById("admin-panel").style.display = "block";
    } else {
      status.textContent = "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥";
      status.className = "err";
    }
  };

  // ‚ûï —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  document.getElementById("create-user-btn").onclick = async () => {
    const loginVal = document.getElementById("new-login").value.trim();
    const passVal = document.getElementById("new-password").value.trim();
    const roleVal = document.getElementById("new-role").value;
    const status = document.getElementById("create-user-status");

    if (!loginVal || !passVal) {
      status.textContent = "‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è";
      status.className = "err";
      return;
    }

    await set(ref(db, "users/" + loginVal), {
      login: loginVal,
      password: passVal,
      role: roleVal
    });

    status.textContent = "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω";
    status.className = "ok";

    document.getElementById("new-login").value = "";
    document.getElementById("new-password").value = "";
  };
</script>
<script>
document.getElementById("create-user-btn").onclick = async () => {
  const login = document.getElementById("new-login").value.trim().toLowerCase();
  const password = document.getElementById("new-password").value.trim();
  const role = document.getElementById("new-role").value;
  const status = document.getElementById("create-user-status");

  if (!login || !password) {
    status.textContent = "‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è";
    return;
  }

  await window.firebaseSet(
    window.firebaseRef(window.firebaseDB, "users/" + login),
    {
      login,
      password,
      role
    }
  );

  status.textContent = "‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω";
};
</script>
  
</body>
</html>


